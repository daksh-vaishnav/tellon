// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int         @id @default(autoincrement())
  role       UserRole    @default(USER)
  username   String      @unique
  email      String      @unique
  password   String
  profilePic String?
  balance    Float
  orders     Orderbook[]
  createAt   DateTime    @default(now())
  updatedAt  DateTime    @default(now()) @updatedAt
}

model Market {
  id         Int              @id @default(autoincrement())
  title      String
  thumbnail  String?
  outcomes   Outcome[]
  orderbooks Orderbook[]
  category   marketCategory[]
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @default(now()) @updatedAt
}

model marketCategory {
  id      Int      @id @default(autoincrement())
  name    String   @unique // e.g., Sports, Politics, Finance
  markets Market[]
}

model Outcome {
  id         Int         @id @default(autoincrement())
  market     Market      @relation(fields: [marketId], references: [id])
  marketId   Int
  label      String? // if null then outcome may be YES/NO, if given then its be a categorical outcome
  type       OutcomeType
  orderbooks Orderbook[]
}

model Orderbook {
  id          Int         @id @default(autoincrement())
  user        User        @relation(fields: [userId], references: [id])
  userId      Int
  market      Market      @relation(fields: [marketId], references: [id])
  marketId    Int
  outcome     Outcome     @relation(fields: [outcomeId], references: [id])
  outcomeId   Int
  type        OrderType
  price       Float
  quantity    Int
  executedQty Int?
  status      OrderStatus
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

enum OrderType {
  BUY
  SELL
}

enum OrderStatus {
  OPEN
  PARTIAL
  FILLED
  CANCEL
}

enum UserRole {
  ADMIN
  USER
}

enum OutcomeType {
  YES
  NO
}
